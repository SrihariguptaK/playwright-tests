[
  {
    "storyId": "story-3",
    "storyTitle": "As Approver, I want to receive notifications for pending schedule change approvals to achieve timely decision-making",
    "testCases": [
      {
        "id": "tc-001",
        "title": "Validate notification sent upon schedule change request submission",
        "type": "happy-path",
        "priority": "High",
        "preconditions": [
          "Scheduler user account exists and has permission to submit schedule change requests",
          "Approver user account exists with valid email address configured",
          "Approver has notification preferences set to receive both email and in-app notifications",
          "User is logged into the system",
          "NotificationQueue service is running and operational",
          "Email service is configured and operational"
        ],
        "steps": [
          {
            "step": 1,
            "action": "Scheduler navigates to the schedule change request submission form",
            "expectedResult": "Schedule change request form is displayed with all required fields"
          },
          {
            "step": 2,
            "action": "Scheduler fills in all required fields (date, time, reason, etc.) and submits the schedule change request",
            "expectedResult": "System accepts the submission, displays success message, and generates a unique request ID"
          },
          {
            "step": 3,
            "action": "System processes the request and identifies the assigned approver based on workflow rules",
            "expectedResult": "Notification is generated for the assigned approver and queued in NotificationQueue within 1 minute"
          },
          {
            "step": 4,
            "action": "Check approver's email inbox for notification",
            "expectedResult": "Approver receives email notification containing request ID, scheduler name, requested changes, submission timestamp, and direct link to review the request"
          },
          {
            "step": 5,
            "action": "Approver logs into the system and checks in-app notifications",
            "expectedResult": "In-app notification appears in notification center with same details as email, marked as unread with notification badge"
          },
          {
            "step": 6,
            "action": "Approver clicks on the in-app notification link",
            "expectedResult": "System navigates directly to the schedule change request details page showing complete request information including scheduler details, requested changes, reason, and action buttons"
          },
          {
            "step": 7,
            "action": "Verify notification content accuracy by comparing with submitted request details",
            "expectedResult": "All information in notification matches the original schedule change request data (dates, times, scheduler name, request ID)"
          }
        ],
        "postconditions": [
          "Notification is marked as delivered in system logs",
          "Notification delivery status is logged in NotificationQueue table",
          "In-app notification remains accessible until approver takes action or marks as read",
          "Request status remains 'Pending Approval'",
          "Audit trail records notification sent event with timestamp"
        ],
        "estimatedTime": "8 mins"
      },
      {
        "id": "tc-002",
        "title": "Verify no duplicate notifications for the same pending approval",
        "type": "edge-case",
        "priority": "High",
        "preconditions": [
          "Schedule change request has been submitted and is in pending approval status",
          "Initial notification has already been sent to approver",
          "Approver has not yet taken action on the request",
          "NotificationQueue service is operational",
          "System has duplicate detection mechanism enabled"
        ],
        "steps": [
          {
            "step": 1,
            "action": "Verify initial notification was sent by checking NotificationQueue table for the request ID",
            "expectedResult": "One notification record exists with status 'Delivered' for the pending approval request"
          },
          {
            "step": 2,
            "action": "Count the number of email notifications in approver's inbox for this specific request ID",
            "expectedResult": "Exactly one email notification exists for the request"
          },
          {
            "step": 3,
            "action": "Count the number of in-app notifications for this specific request ID",
            "expectedResult": "Exactly one in-app notification exists for the request"
          },
          {
            "step": 4,
            "action": "Trigger a system event that would normally generate a notification (e.g., refresh workflow, system restart, or manual notification trigger)",
            "expectedResult": "System checks NotificationQueue and identifies existing notification for the pending approval"
          },
          {
            "step": 5,
            "action": "Wait 2 minutes and check approver's email inbox again",
            "expectedResult": "No additional email notification is received; count remains at one"
          },
          {
            "step": 6,
            "action": "Check in-app notification center for duplicate notifications",
            "expectedResult": "No duplicate in-app notification appears; only the original notification is displayed"
          },
          {
            "step": 7,
            "action": "Query NotificationQueue table for all notifications related to this request ID",
            "expectedResult": "Only one notification record exists; no duplicate entries are created"
          },
          {
            "step": 8,
            "action": "Review system logs for duplicate prevention messages",
            "expectedResult": "System logs show duplicate detection triggered and prevented duplicate notification from being sent"
          }
        ],
        "postconditions": [
          "Only one notification exists for the pending approval in NotificationQueue",
          "Approver has received exactly one email and one in-app notification",
          "System logs document duplicate prevention action",
          "Request status remains 'Pending Approval'",
          "No unnecessary notification records are created in the database"
        ],
        "estimatedTime": "6 mins"
      },
      {
        "id": "tc-003",
        "title": "Ensure escalation notifications are sent for overdue approvals",
        "type": "edge-case",
        "priority": "High",
        "preconditions": [
          "Schedule change request has been submitted and is in pending approval status",
          "Initial notification has been sent to primary approver",
          "Escalation threshold time period is configured in system (e.g., 24 hours)",
          "Escalation recipients are configured (e.g., manager, secondary approver)",
          "Primary approver has not taken action on the request",
          "System escalation job/scheduler is running",
          "Current time has exceeded the escalation threshold since request submission"
        ],
        "steps": [
          {
            "step": 1,
            "action": "Verify the schedule change request submission timestamp and calculate time elapsed",
            "expectedResult": "Request has been pending for longer than the configured escalation threshold (e.g., 24 hours)"
          },
          {
            "step": 2,
            "action": "Check the request status in the system",
            "expectedResult": "Request status shows 'Pending Approval' with no approval decision recorded"
          },
          {
            "step": 3,
            "action": "Wait for the system escalation job to run (or manually trigger escalation check if available)",
            "expectedResult": "System identifies the overdue approval and triggers escalation workflow"
          },
          {
            "step": 4,
            "action": "Query NotificationQueue table for escalation notifications",
            "expectedResult": "Escalation notification records are created for designated escalation recipients with notification type 'Escalation'"
          },
          {
            "step": 5,
            "action": "Check email inbox of designated escalation recipients (e.g., manager, secondary approver)",
            "expectedResult": "Escalation notification email is received containing request ID, original approver name, overdue duration, urgency indicator, and direct link to request"
          },
          {
            "step": 6,
            "action": "Check in-app notifications for escalation recipients",
            "expectedResult": "In-app escalation notification appears with high priority indicator, showing overdue status and request details"
          },
          {
            "step": 7,
            "action": "Verify escalation notification content includes overdue information",
            "expectedResult": "Notification clearly states the approval is overdue, shows how long it has been pending, and identifies the original approver who has not responded"
          },
          {
            "step": 8,
            "action": "Check that original approver also receives escalation reminder notification",
            "expectedResult": "Original approver receives reminder notification indicating the request is overdue and has been escalated"
          },
          {
            "step": 9,
            "action": "Review system audit logs for escalation event",
            "expectedResult": "Audit trail records escalation event with timestamp, original approver, escalation recipients, and reason for escalation"
          }
        ],
        "postconditions": [
          "Escalation notifications are delivered to all designated recipients",
          "NotificationQueue contains escalation notification records with 'Delivered' status",
          "Request status is updated to include escalation flag or indicator",
          "Audit trail documents complete escalation event",
          "Original approver is notified of escalation",
          "Request remains in 'Pending Approval' status awaiting decision"
        ],
        "estimatedTime": "10 mins"
      }
    ]
  },
  {
    "storyId": "story-4",
    "storyTitle": "As Approver, I want to review and make decisions on schedule change requests to achieve timely and accurate approvals",
    "testCases": [
      {
        "id": "tc-004",
        "title": "Validate approval decision submission with comments",
        "type": "happy-path",
        "priority": "High",
        "preconditions": [
          "Approver user account exists with appropriate approval permissions",
          "Schedule change request exists in 'Pending Approval' status",
          "Approver has received notification for the pending request",
          "Approver is logged into the system",
          "ScheduleChangeRequests and ApprovalDecisions tables are accessible",
          "API endpoint PUT /api/approval-decisions is operational"
        ],
        "steps": [
          {
            "step": 1,
            "action": "Approver logs into the system and navigates to the 'Pending Approvals' section from the main dashboard",
            "expectedResult": "Pending Approvals page displays with a list of all schedule change requests awaiting the approver's decision"
          },
          {
            "step": 2,
            "action": "Approver locates the specific schedule change request and clicks to view details",
            "expectedResult": "Request details page is displayed showing complete information including: request ID, scheduler name, current schedule, requested changes, reason for change, submission date/time, and any supporting documentation"
          },
          {
            "step": 3,
            "action": "Approver reviews all request details and supporting information",
            "expectedResult": "All request information is clearly visible and formatted for easy review; action buttons (Approve/Reject) are prominently displayed"
          },
          {
            "step": 4,
            "action": "Approver clicks the 'Reject' button",
            "expectedResult": "Decision form expands showing comment input field marked as required, with character counter and submit/cancel buttons"
          },
          {
            "step": 5,
            "action": "Approver enters detailed rejection comments in the comment field (e.g., 'Request conflicts with existing coverage requirements for the emergency department. Please coordinate with shift supervisor before resubmitting.')",
            "expectedResult": "Comment text is accepted and displayed in the input field; character count updates; submit button becomes enabled"
          },
          {
            "step": 6,
            "action": "Approver reviews the entered comments for accuracy and completeness",
            "expectedResult": "Comments are clearly visible in the input field and can be edited if needed"
          },
          {
            "step": 7,
            "action": "Approver clicks the 'Submit Decision' button",
            "expectedResult": "System displays confirmation dialog asking approver to confirm the rejection decision"
          },
          {
            "step": 8,
            "action": "Approver confirms the decision in the confirmation dialog",
            "expectedResult": "System processes the decision within 2 seconds and displays success message confirming rejection has been recorded"
          },
          {
            "step": 9,
            "action": "Verify the request status has been updated by refreshing the pending approvals list",
            "expectedResult": "Request no longer appears in pending approvals list; status is updated to 'Rejected'"
          },
          {
            "step": 10,
            "action": "Navigate to the request details or history page to view the decision",
            "expectedResult": "Request shows status 'Rejected' with approver name, rejection timestamp, and entered comments clearly displayed"
          },
          {
            "step": 11,
            "action": "Query ApprovalDecisions table to verify audit trail entry",
            "expectedResult": "New record exists containing: request ID, approver ID, decision (Rejected), comments, timestamp, and IP address"
          },
          {
            "step": 12,
            "action": "Verify scheduler receives notification of the rejection decision",
            "expectedResult": "Scheduler receives email and in-app notification containing rejection decision and approver's comments"
          }
        ],
        "postconditions": [
          "Request status is permanently updated to 'Rejected' in ScheduleChangeRequests table",
          "Approval decision is recorded in ApprovalDecisions table with complete audit information",
          "Approver's comments are stored and associated with the decision",
          "Scheduler is notified of the rejection with comments",
          "Request is removed from approver's pending queue",
          "Audit trail is complete with timestamp, approver identity, and decision details",
          "System logs record the decision processing event"
        ],
        "estimatedTime": "7 mins"
      },
      {
        "id": "tc-005",
        "title": "Verify rejection is blocked without comments",
        "type": "error-case",
        "priority": "High",
        "preconditions": [
          "Approver user account exists with appropriate approval permissions",
          "Schedule change request exists in 'Pending Approval' status",
          "Approver is logged into the system",
          "Approver has navigated to the request details page",
          "Validation rules for mandatory comments on rejection are configured and active"
        ],
        "steps": [
          {
            "step": 1,
            "action": "Approver navigates to the pending schedule change request details page",
            "expectedResult": "Request details page displays with all relevant information and Approve/Reject action buttons"
          },
          {
            "step": 2,
            "action": "Approver clicks the 'Reject' button",
            "expectedResult": "Decision form expands showing comment input field with required field indicator (asterisk or 'Required' label)"
          },
          {
            "step": 3,
            "action": "Approver leaves the comment field completely empty (no text entered)",
            "expectedResult": "Comment field remains empty; submit button may be disabled or validation is pending"
          },
          {
            "step": 4,
            "action": "Approver attempts to click the 'Submit Decision' button without entering any comments",
            "expectedResult": "System prevents submission and displays validation error message: 'Comments are required when rejecting a request' or similar message in red text near the comment field"
          },
          {
            "step": 5,
            "action": "Verify the comment field is highlighted or marked to indicate the validation error",
            "expectedResult": "Comment field is highlighted with red border or error styling to draw attention to the required field"
          },
          {
            "step": 6,
            "action": "Verify the request status has not changed by checking the database or UI",
            "expectedResult": "Request status remains 'Pending Approval'; no decision record is created in ApprovalDecisions table"
          },
          {
            "step": 7,
            "action": "Approver enters only whitespace characters (spaces, tabs) in the comment field",
            "expectedResult": "Comment field shows the whitespace but validation still treats it as empty"
          },
          {
            "step": 8,
            "action": "Approver attempts to submit the decision with only whitespace in comments",
            "expectedResult": "System prevents submission and displays validation error: 'Please enter meaningful comments' or 'Comments cannot be empty'"
          },
          {
            "step": 9,
            "action": "Approver enters a very short comment (e.g., 1-2 characters like 'No')",
            "expectedResult": "System either accepts if minimum length is met, or displays error if minimum character requirement exists (e.g., 'Comments must be at least 10 characters')"
          },
          {
            "step": 10,
            "action": "Verify no audit trail entry was created for the failed submission attempts",
            "expectedResult": "ApprovalDecisions table contains no new records; audit logs may show validation failures but no decision records"
          }
        ],
        "postconditions": [
          "Request status remains 'Pending Approval' unchanged",
          "No decision record is created in ApprovalDecisions table",
          "No notification is sent to scheduler about rejection",
          "Request remains in approver's pending queue",
          "Approver remains on the decision page with error message displayed",
          "System maintains data integrity by preventing incomplete rejection decisions"
        ],
        "estimatedTime": "5 mins"
      },
      {
        "id": "tc-006",
        "title": "Ensure unauthorized users cannot approve or reject requests",
        "type": "error-case",
        "priority": "High",
        "preconditions": [
          "Schedule change request exists in 'Pending Approval' status",
          "User account exists without approver role (e.g., regular scheduler, viewer, or other non-approver role)",
          "Role-based access control (RBAC) is configured and enforced",
          "User is logged into the system with non-approver credentials",
          "Security policies are active and enforced at UI and API levels"
        ],
        "steps": [
          {
            "step": 1,
            "action": "User without approver role logs into the system",
            "expectedResult": "User successfully logs in and is directed to their role-appropriate dashboard"
          },
          {
            "step": 2,
            "action": "User attempts to navigate to the 'Pending Approvals' section via menu or direct URL",
            "expectedResult": "System denies access and displays error message: 'Access Denied - You do not have permission to view pending approvals' or redirects to unauthorized access page"
          },
          {
            "step": 3,
            "action": "Verify the Pending Approvals menu option is not visible or is disabled for this user",
            "expectedResult": "Pending Approvals menu item is either hidden from navigation or displayed as disabled/grayed out"
          },
          {
            "step": 4,
            "action": "User attempts to access a specific approval request details page by manually entering the URL (e.g., /approvals/request/12345)",
            "expectedResult": "System blocks access and displays 403 Forbidden error or 'Access Denied' page with message indicating insufficient permissions"
          },
          {
            "step": 5,
            "action": "User attempts to access the approval decision UI by constructing the direct URL",
            "expectedResult": "System prevents access and returns authorization error; user is not able to view approval action buttons"
          },
          {
            "step": 6,
            "action": "Using API testing tool (e.g., Postman) or browser developer tools, attempt to send PUT request to /api/approval-decisions endpoint with unauthorized user's authentication token",
            "expectedResult": "API returns 403 Forbidden status code with error message: 'User does not have approver role' or 'Insufficient permissions to make approval decisions'"
          },
          {
            "step": 7,
            "action": "Verify the request payload is rejected before any database operations occur",
            "expectedResult": "No changes are made to ScheduleChangeRequests or ApprovalDecisions tables; request status remains unchanged"
          },
          {
            "step": 8,
            "action": "Check system security logs for the unauthorized access attempts",
            "expectedResult": "Security logs record the unauthorized access attempts with user ID, timestamp, attempted action, and denial reason"
          },
          {
            "step": 9,
            "action": "Verify no audit trail entry is created for the unauthorized attempt in ApprovalDecisions table",
            "expectedResult": "ApprovalDecisions table contains no records from the unauthorized user; only security logs capture the attempt"
          },
          {
            "step": 10,
            "action": "Attempt the same unauthorized access with a different non-approver role (e.g., viewer role)",
            "expectedResult": "System consistently denies access regardless of the specific non-approver role; same security behavior is enforced"
          }
        ],
        "postconditions": [
          "Request status remains 'Pending Approval' unchanged",
          "No approval or rejection decision is recorded",
          "No unauthorized access is granted to approval functionality",
          "Security logs document all unauthorized access attempts",
          "System maintains data integrity and security",
          "No notifications are sent regarding approval decisions",
          "User remains restricted to their authorized role permissions"
        ],
        "estimatedTime": "8 mins"
      }
    ]
  }
]