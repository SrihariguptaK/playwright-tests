{
  "storyId": "db-story-story-4",
  "storyTitle": "As Tax Accountant, I want to apply correct tax rates to taxable income to achieve accurate final tax due calculation",
  "functional": [
    {
      "id": "TC-FUNC-001",
      "title": "Verify successful tax rate application for single income record in standard bracket",
      "category": "Functional",
      "priority": "High",
      "preconditions": [
        "Tax Accountant is logged in with valid credentials",
        "Tax rate tables are loaded and current",
        "At least one taxable income record exists"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Navigate to tax calculation page",
          "expectedResult": "Tax calculation page displays with income records"
        },
        {
          "step": 2,
          "action": "Select a single income record with taxable income of $75,000",
          "expectedResult": "Record is selected and highlighted"
        },
        {
          "step": 3,
          "action": "Click 'Apply Tax Rates' button",
          "expectedResult": "System retrieves current tax rate tables and calculates tax due"
        },
        {
          "step": 4,
          "action": "Review the tax calculation breakdown",
          "expectedResult": "Detailed breakdown shows correct tax brackets applied, rates used, and final tax due amount"
        },
        {
          "step": 5,
          "action": "Confirm the calculation",
          "expectedResult": "Tax calculation is saved and marked as confirmed"
        }
      ],
      "postconditions": [
        "Tax due is calculated and stored correctly",
        "Audit trail records the tax rate application",
        "Calculation status is updated to 'Confirmed'"
      ]
    },
    {
      "id": "TC-FUNC-002",
      "title": "Verify tax rate application for multiple income records across different brackets",
      "category": "Functional",
      "priority": "High",
      "preconditions": [
        "Tax Accountant is logged in",
        "Multiple income records exist with varying taxable income amounts",
        "Current tax rate tables are available"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Navigate to tax calculation page and select 10 records with income ranging from $20,000 to $500,000",
          "expectedResult": "All 10 records are selected"
        },
        {
          "step": 2,
          "action": "Click 'Apply Tax Rates' to batch process",
          "expectedResult": "System processes all records and applies appropriate tax rates per bracket"
        },
        {
          "step": 3,
          "action": "Review calculation summary",
          "expectedResult": "Summary shows all 10 records processed with individual tax due amounts"
        },
        {
          "step": 4,
          "action": "Drill down into one record's detailed breakdown",
          "expectedResult": "Breakdown displays progressive tax calculation with all applicable brackets and rates"
        }
      ],
      "postconditions": [
        "All records have accurate tax due calculations",
        "Audit trail captures batch processing details"
      ]
    },
    {
      "id": "TC-FUNC-003",
      "title": "Verify detailed tax calculation breakdown displays all bracket information",
      "category": "Functional",
      "priority": "High",
      "preconditions": [
        "Tax Accountant is logged in",
        "Income record with $150,000 taxable income exists",
        "Tax rates are configured for multiple brackets"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Select income record and apply tax rates",
          "expectedResult": "Tax calculation completes successfully"
        },
        {
          "step": 2,
          "action": "Open detailed calculation breakdown",
          "expectedResult": "Breakdown shows each tax bracket applied (e.g., 10% up to $10,000, 12% from $10,001-$40,000, etc.)"
        },
        {
          "step": 3,
          "action": "Verify tax amount per bracket is displayed",
          "expectedResult": "Each bracket shows income portion, rate applied, and tax amount calculated"
        },
        {
          "step": 4,
          "action": "Verify total tax due matches sum of all brackets",
          "expectedResult": "Total tax due equals sum of individual bracket calculations"
        }
      ],
      "postconditions": [
        "Detailed breakdown is available for audit",
        "All calculation components are transparent and verifiable"
      ]
    },
    {
      "id": "TC-FUNC-004",
      "title": "Verify performance SLA for processing 5,000 income records",
      "category": "Functional",
      "priority": "High",
      "preconditions": [
        "Tax Accountant is logged in",
        "Exactly 5,000 income records are loaded in the system",
        "Tax rate tables are current and accessible"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Select all 5,000 income records for tax calculation",
          "expectedResult": "All records are selected successfully"
        },
        {
          "step": 2,
          "action": "Click 'Apply Tax Rates' and start timer",
          "expectedResult": "System begins processing with progress indicator"
        },
        {
          "step": 3,
          "action": "Monitor processing time until completion",
          "expectedResult": "Processing completes within 30 seconds"
        },
        {
          "step": 4,
          "action": "Verify all 5,000 records have tax due calculated",
          "expectedResult": "All records show calculated tax due with no errors"
        }
      ],
      "postconditions": [
        "Performance SLA of 30 seconds is met",
        "All 5,000 records processed successfully"
      ]
    },
    {
      "id": "TC-FUNC-005",
      "title": "Verify audit trail captures tax rate application details",
      "category": "Functional",
      "priority": "Medium",
      "preconditions": [
        "Tax Accountant is logged in",
        "Income records exist for processing",
        "Audit logging is enabled"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Apply tax rates to selected income records",
          "expectedResult": "Tax calculation completes successfully"
        },
        {
          "step": 2,
          "action": "Navigate to audit trail/log section",
          "expectedResult": "Audit trail page displays"
        },
        {
          "step": 3,
          "action": "Filter audit logs for recent tax rate application",
          "expectedResult": "Log entries show timestamp, user, records processed, tax rates used"
        },
        {
          "step": 4,
          "action": "Verify log includes tax rate table version used",
          "expectedResult": "Audit entry captures tax rate table version and effective date"
        }
      ],
      "postconditions": [
        "Complete audit trail is maintained",
        "Tax rate application is traceable"
      ]
    },
    {
      "id": "TC-FUNC-006",
      "title": "Verify Tax Accountant can review and confirm calculations before finalizing",
      "category": "Functional",
      "priority": "Medium",
      "preconditions": [
        "Tax Accountant is logged in",
        "Tax rates have been applied to income records",
        "Calculations are in 'Pending Review' status"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Navigate to pending tax calculations",
          "expectedResult": "List of calculated records awaiting confirmation displays"
        },
        {
          "step": 2,
          "action": "Review calculation details for accuracy",
          "expectedResult": "All calculation breakdowns are accessible and clear"
        },
        {
          "step": 3,
          "action": "Click 'Confirm Calculations' button",
          "expectedResult": "System prompts for confirmation"
        },
        {
          "step": 4,
          "action": "Confirm the action",
          "expectedResult": "Calculations are marked as confirmed and finalized"
        }
      ],
      "postconditions": [
        "Tax calculations are confirmed and locked",
        "Status updated to 'Confirmed' in the system"
      ]
    },
    {
      "id": "TC-FUNC-007",
      "title": "Verify correct tax rate retrieval from current tax rate tables",
      "category": "Functional",
      "priority": "High",
      "preconditions": [
        "Tax Accountant is logged in",
        "Tax rate tables are updated with current year rates",
        "Income record exists with known taxable income"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Verify current tax rate table effective date matches current tax year",
          "expectedResult": "Tax rate table shows correct effective date"
        },
        {
          "step": 2,
          "action": "Apply tax rates to test income record",
          "expectedResult": "System retrieves and applies current year tax rates"
        },
        {
          "step": 3,
          "action": "Compare calculated tax with manual calculation using same rates",
          "expectedResult": "System calculation matches manual calculation exactly"
        },
        {
          "step": 4,
          "action": "Review breakdown to confirm rate percentages match tax table",
          "expectedResult": "All rates displayed match current tax rate table values"
        }
      ],
      "postconditions": [
        "Correct tax rates are confirmed in use",
        "Tax calculation accuracy is validated"
      ]
    }
  ],
  "negative": [
    {
      "id": "TC-NEGA-001",
      "title": "Verify system handles missing tax rate table gracefully",
      "category": "Negative",
      "priority": "High",
      "preconditions": [
        "Tax Accountant is logged in",
        "Tax rate table is unavailable or not loaded",
        "Income records exist for processing"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Select income records for tax calculation",
          "expectedResult": "Records are selected"
        },
        {
          "step": 2,
          "action": "Click 'Apply Tax Rates' button",
          "expectedResult": "System attempts to retrieve tax rate table"
        },
        {
          "step": 3,
          "action": "Observe system response when table is unavailable",
          "expectedResult": "Error message displays: 'Tax rate table unavailable. Please contact administrator.'"
        },
        {
          "step": 4,
          "action": "Verify no partial calculations are saved",
          "expectedResult": "No tax due amounts are calculated or stored"
        }
      ],
      "postconditions": [
        "System remains in stable state",
        "No incorrect calculations are saved"
      ]
    },
    {
      "id": "TC-NEGA-002",
      "title": "Verify unauthorized user cannot apply tax rates",
      "category": "Negative",
      "priority": "High",
      "preconditions": [
        "User is logged in without Tax Accountant role",
        "Income records exist in the system",
        "Tax rate tables are available"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Attempt to navigate to tax calculation page",
          "expectedResult": "Access denied or page not visible in navigation"
        },
        {
          "step": 2,
          "action": "Attempt direct API call to POST /api/taxrates/apply",
          "expectedResult": "API returns 403 Forbidden error"
        },
        {
          "step": 3,
          "action": "Verify no tax calculations are processed",
          "expectedResult": "No changes to income records or tax due amounts"
        }
      ],
      "postconditions": [
        "Unauthorized access is prevented",
        "Security audit log captures unauthorized attempt"
      ]
    },
    {
      "id": "TC-NEGA-003",
      "title": "Verify system handles invalid or corrupted income data",
      "category": "Negative",
      "priority": "Medium",
      "preconditions": [
        "Tax Accountant is logged in",
        "Income record exists with null or negative taxable income value",
        "Tax rate tables are available"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Select income record with invalid data",
          "expectedResult": "Record is selected"
        },
        {
          "step": 2,
          "action": "Click 'Apply Tax Rates' button",
          "expectedResult": "System validates input data"
        },
        {
          "step": 3,
          "action": "Observe validation error",
          "expectedResult": "Error message displays: 'Invalid taxable income data. Please correct before applying tax rates.'"
        },
        {
          "step": 4,
          "action": "Verify record is flagged for correction",
          "expectedResult": "Record status shows 'Requires Data Correction'"
        }
      ],
      "postconditions": [
        "Invalid data is not processed",
        "Record is flagged for manual review"
      ]
    },
    {
      "id": "TC-NEGA-004",
      "title": "Verify system handles API timeout during tax rate application",
      "category": "Negative",
      "priority": "Medium",
      "preconditions": [
        "Tax Accountant is logged in",
        "Large batch of income records selected",
        "Network or API response is simulated to timeout"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Select large batch of income records",
          "expectedResult": "Records are selected"
        },
        {
          "step": 2,
          "action": "Click 'Apply Tax Rates' and simulate API timeout",
          "expectedResult": "System waits for response beyond timeout threshold"
        },
        {
          "step": 3,
          "action": "Observe system behavior after timeout",
          "expectedResult": "Error message displays: 'Request timeout. Please try again.'"
        },
        {
          "step": 4,
          "action": "Verify no partial calculations are committed",
          "expectedResult": "All records remain in original state without tax calculations"
        }
      ],
      "postconditions": [
        "Data integrity is maintained",
        "User can retry the operation"
      ]
    }
  ],
  "edgeCases": [
    {
      "id": "TC-EDGE-001",
      "title": "Verify tax calculation for income exactly at bracket boundary",
      "category": "Edge Cases",
      "priority": "High",
      "preconditions": [
        "Tax Accountant is logged in",
        "Income record exists with taxable income exactly at bracket threshold (e.g., $40,000)",
        "Tax rate tables define bracket boundaries"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Select income record with amount exactly at bracket boundary",
          "expectedResult": "Record is selected"
        },
        {
          "step": 2,
          "action": "Apply tax rates",
          "expectedResult": "System calculates tax using correct bracket logic"
        },
        {
          "step": 3,
          "action": "Review calculation breakdown",
          "expectedResult": "Breakdown shows income is correctly assigned to appropriate bracket"
        },
        {
          "step": 4,
          "action": "Verify no rounding errors at boundary",
          "expectedResult": "Tax calculation is accurate to the cent with proper bracket assignment"
        }
      ],
      "postconditions": [
        "Boundary condition handled correctly",
        "Tax calculation is accurate"
      ]
    },
    {
      "id": "TC-EDGE-002",
      "title": "Verify tax calculation for zero taxable income",
      "category": "Edge Cases",
      "priority": "Medium",
      "preconditions": [
        "Tax Accountant is logged in",
        "Income record exists with taxable income of $0",
        "Tax rate tables are available"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Select income record with $0 taxable income",
          "expectedResult": "Record is selected"
        },
        {
          "step": 2,
          "action": "Apply tax rates",
          "expectedResult": "System processes the record"
        },
        {
          "step": 3,
          "action": "Review calculation result",
          "expectedResult": "Tax due is calculated as $0.00"
        },
        {
          "step": 4,
          "action": "Verify breakdown shows no tax brackets applied",
          "expectedResult": "Breakdown indicates zero income with zero tax due"
        }
      ],
      "postconditions": [
        "Zero income case handled correctly",
        "No errors or exceptions occur"
      ]
    },
    {
      "id": "TC-EDGE-003",
      "title": "Verify tax calculation for extremely high income exceeding all brackets",
      "category": "Edge Cases",
      "priority": "Medium",
      "preconditions": [
        "Tax Accountant is logged in",
        "Income record exists with very high taxable income (e.g., $10,000,000)",
        "Tax rate tables define highest bracket"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Select income record with extremely high taxable income",
          "expectedResult": "Record is selected"
        },
        {
          "step": 2,
          "action": "Apply tax rates",
          "expectedResult": "System calculates tax through all brackets"
        },
        {
          "step": 3,
          "action": "Review calculation breakdown",
          "expectedResult": "All brackets are applied progressively, with highest rate applied to income exceeding top bracket"
        },
        {
          "step": 4,
          "action": "Verify total tax due is calculated correctly",
          "expectedResult": "Tax due matches expected calculation for high-income scenario"
        }
      ],
      "postconditions": [
        "High income edge case handled correctly",
        "All tax brackets applied appropriately"
      ]
    },
    {
      "id": "TC-EDGE-004",
      "title": "Verify performance with exactly 5,000 records at SLA boundary",
      "category": "Edge Cases",
      "priority": "High",
      "preconditions": [
        "Tax Accountant is logged in",
        "Exactly 5,000 income records loaded",
        "System is under normal load conditions"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Select all 5,000 records",
          "expectedResult": "All records selected"
        },
        {
          "step": 2,
          "action": "Apply tax rates and measure processing time",
          "expectedResult": "Processing begins with timer"
        },
        {
          "step": 3,
          "action": "Monitor completion time",
          "expectedResult": "Processing completes at or just under 30 seconds"
        },
        {
          "step": 4,
          "action": "Verify all calculations are accurate despite time pressure",
          "expectedResult": "All 5,000 records have correct tax calculations"
        }
      ],
      "postconditions": [
        "SLA boundary condition met",
        "Accuracy maintained under performance constraints"
      ]
    },
    {
      "id": "TC-EDGE-005",
      "title": "Verify tax calculation with income containing fractional cents",
      "category": "Edge Cases",
      "priority": "Low",
      "preconditions": [
        "Tax Accountant is logged in",
        "Income record exists with taxable income including fractional cents (e.g., $50,000.999)",
        "Tax rate tables are available"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Select income record with fractional cent amount",
          "expectedResult": "Record is selected"
        },
        {
          "step": 2,
          "action": "Apply tax rates",
          "expectedResult": "System processes and rounds appropriately"
        },
        {
          "step": 3,
          "action": "Review calculation breakdown",
          "expectedResult": "Tax calculation shows proper rounding to two decimal places"
        },
        {
          "step": 4,
          "action": "Verify final tax due is rounded correctly",
          "expectedResult": "Tax due is displayed as standard currency format (e.g., $X,XXX.XX)"
        }
      ],
      "postconditions": [
        "Fractional amounts handled with proper rounding",
        "Currency formatting is correct"
      ]
    }
  ],
  "accessibility": [
    {
      "id": "TC-ACCE-001",
      "title": "Verify keyboard navigation through tax calculation workflow",
      "category": "Accessibility",
      "priority": "High",
      "preconditions": [
        "Tax Accountant is logged in",
        "Tax calculation page is loaded",
        "Income records are available"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Use Tab key to navigate to income record selection",
          "expectedResult": "Focus moves to record selection area with visible focus indicator"
        },
        {
          "step": 2,
          "action": "Use arrow keys to select records and Space to check/uncheck",
          "expectedResult": "Records can be selected using keyboard only"
        },
        {
          "step": 3,
          "action": "Tab to 'Apply Tax Rates' button and press Enter",
          "expectedResult": "Tax calculation initiates via keyboard"
        },
        {
          "step": 4,
          "action": "Tab through calculation breakdown results",
          "expectedResult": "All result elements are keyboard accessible with proper focus order"
        }
      ],
      "postconditions": [
        "Complete workflow is keyboard accessible",
        "Focus indicators are visible throughout"
      ]
    },
    {
      "id": "TC-ACCE-002",
      "title": "Verify screen reader announces tax calculation results correctly",
      "category": "Accessibility",
      "priority": "High",
      "preconditions": [
        "Tax Accountant is logged in with screen reader enabled (NVDA/JAWS)",
        "Income records exist",
        "Tax rates have been applied"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Navigate to tax calculation results with screen reader",
          "expectedResult": "Screen reader announces 'Tax calculation results' heading"
        },
        {
          "step": 2,
          "action": "Navigate through calculation breakdown",
          "expectedResult": "Screen reader announces each bracket, rate, and amount with proper labels"
        },
        {
          "step": 3,
          "action": "Focus on final tax due amount",
          "expectedResult": "Screen reader announces 'Final tax due: [amount]' clearly"
        },
        {
          "step": 4,
          "action": "Navigate to confirm button",
          "expectedResult": "Screen reader announces button purpose and state"
        }
      ],
      "postconditions": [
        "All critical information is announced by screen reader",
        "ARIA labels are properly implemented"
      ]
    },
    {
      "id": "TC-ACCE-003",
      "title": "Verify ARIA labels and roles for tax calculation components",
      "category": "Accessibility",
      "priority": "Medium",
      "preconditions": [
        "Tax Accountant is logged in",
        "Tax calculation page is loaded",
        "Browser developer tools are available"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Inspect 'Apply Tax Rates' button with accessibility inspector",
          "expectedResult": "Button has proper role='button' and aria-label describing action"
        },
        {
          "step": 2,
          "action": "Inspect calculation breakdown table/list",
          "expectedResult": "Proper ARIA roles (table/grid) and labels for headers are present"
        },
        {
          "step": 3,
          "action": "Inspect progress indicator during processing",
          "expectedResult": "Progress has role='progressbar' with aria-valuenow and aria-valuemax"
        },
        {
          "step": 4,
          "action": "Inspect error messages if validation fails",
          "expectedResult": "Errors have role='alert' and aria-live='assertive' for immediate announcement"
        }
      ],
      "postconditions": [
        "All interactive elements have proper ARIA attributes",
        "Semantic HTML and ARIA roles are correctly implemented"
      ]
    },
    {
      "id": "TC-ACCE-004",
      "title": "Verify focus management during tax calculation process",
      "category": "Accessibility",
      "priority": "Medium",
      "preconditions": [
        "Tax Accountant is logged in",
        "Income records are selected",
        "User is navigating via keyboard"
      ],
      "steps": [
        {
          "step": 1,
          "action": "Press Enter on 'Apply Tax Rates' button",
          "expectedResult": "Focus remains on button or moves to progress indicator"
        },
        {
          "step": 2,
          "action": "Wait for calculation to complete",
          "expectedResult": "Focus automatically moves to results section or confirmation message"
        },
        {
          "step": 3,
          "action": "Verify focus is not lost during processing",
          "expectedResult": "Focus is managed programmatically and remains visible"
        },
        {
          "step": 4,
          "action": "Tab through results after completion",
          "expectedResult": "Focus order is logical and follows visual layout"
        }
      ],
      "postconditions": [
        "Focus is managed appropriately throughout workflow",
        "No focus traps or lost focus states occur"
      ]
    }
  ],
  "selectedTypes": {
    "functional": true,
    "negative": true,
    "edgeCases": true,
    "accessibility": true
  },
  "userStoryObject": {
    "id": "db-story-story-4",
    "title": "As Tax Accountant, I want to apply correct tax rates to taxable income to achieve accurate final tax due calculation",
    "description": "CONTEXT & BACKGROUND:\nApplying the correct tax rates based on taxable income brackets is essential for precise tax due calculations. This story ensures tax rates are applied automatically and accurately.\n\nCURRENT STATE:\nTax rates are manually applied, prone to errors and outdated information.\n\nDESIRED STATE:\nAutomated tax rate application based on up-to-date tax brackets and rules.\n\nKEY FUNCTIONALITY:\n• Retrieve current tax rate tables\n• Determine applicable tax rate per income bracket\n• Calculate final tax due based on taxable income\n• Provide detailed calculation breakdown\n• Maintain audit trail of tax rate application\n\nUSER INTERACTION FLOW:\n1. Tax Accountant reviews taxable income data\n2. System retrieves current tax rate tables\n3. System applies tax rates to calculate final tax due\n4. Displays detailed tax calculation breakdown\n5. Tax Accountant reviews and confirms calculations\n\nTECHNICAL CONSIDERATIONS:\n• Data source: Tax rate tables database\n• Validation rules: Correct bracket matching\n• API endpoints: POST /api/taxrates/apply\n• Security: Role-based access, input validation\n• Performance: Calculation completes within 30 seconds for 5,000 records\n\nOUT OF SCOPE:\n• Tax rate table management\n• Manual tax rate overrides\n\nSUCCESS METRICS:\n• 100% accuracy in tax rate application\n• Calculation process completes within SLA\n• Reduction in tax calculation errors by 95%",
    "persona": "Tax Accountant",
    "personaId": "",
    "acceptanceCriteria": [
      "System applies correct tax rates based on current tax brackets",
      "System calculates final tax due accurately for all income records",
      "System provides detailed breakdown of tax calculations per record",
      "System completes tax rate application within 30 seconds for 5,000 records",
      "Tax Accountant can review and confirm final tax due calculations"
    ],
    "priority": "Medium",
    "storyPoints": 4,
    "epicId": "",
    "status": "Backlog"
  }
}