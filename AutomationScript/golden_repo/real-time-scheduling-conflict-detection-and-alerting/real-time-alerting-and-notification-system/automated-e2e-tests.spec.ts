json
{
  "success": true,
  "playwrightTests": [
    {
      "storyId": "story-11",
      "storyTitle": "As Scheduler, I want to receive real-time alerts for scheduling conflicts to avoid double bookings",
      "testFile": "scheduling-conflict-alerts.spec.ts",
      "testCode": "import { test, expect } from '@playwright/test';\n\ntest.describe('Story-11: Real-time Scheduling Conflict Alerts', () => {\n  test.beforeEach(async ({ page }) => {\n    // Navigate to scheduling application\n    await page.goto('/scheduler/dashboard');\n    // Login as scheduler\n    await page.fill('[data-testid=\"username-input\"]', 'scheduler@example.com');\n    await page.fill('[data-testid=\"password-input\"]', 'SecurePass123');\n    await page.click('[data-testid=\"login-button\"]');\n    await expect(page.locator('[data-testid=\"scheduler-dashboard\"]')).toBeVisible();\n  });\n\n  test('Validate alert sent within 5 seconds of conflict detection', async ({ page }) => {\n    // Step 1: Create a booking that conflicts with an existing one\n    await page.click('[data-testid=\"create-booking-button\"]');\n    await page.fill('[data-testid=\"booking-resource-input\"]', 'Conference Room A');\n    await page.fill('[data-testid=\"booking-date-input\"]', '2024-03-15');\n    await page.fill('[data-testid=\"booking-start-time-input\"]', '10:00');\n    await page.fill('[data-testid=\"booking-end-time-input\"]', '11:00');\n    await page.fill('[data-testid=\"booking-title-input\"]', 'Team Meeting');\n    \n    // Start timer to measure alert delivery time\n    const startTime = Date.now();\n    await page.click('[data-testid=\"submit-booking-button\"]');\n    \n    // Expected Result: Conflict detected by system\n    await expect(page.locator('[data-testid=\"conflict-detected-indicator\"]')).toBeVisible({ timeout: 3000 });\n    \n    // Step 2: Monitor alert delivery to scheduler\n    const alertNotification = page.locator('[data-testid=\"alert-notification\"]');\n    await expect(alertNotification).toBeVisible({ timeout: 5000 });\n    \n    // Expected Result: Alert received within 5 seconds\n    const alertDeliveryTime = Date.now() - startTime;\n    expect(alertDeliveryTime).toBeLessThanOrEqual(5000);\n    \n    // Step 3: Verify alert content\n    await alertNotification.click();\n    const alertDetails = page.locator('[data-testid=\"alert-details-modal\"]');\n    await expect(alertDetails).toBeVisible();\n    \n    // Expected Result: Alert contains detailed conflict information\n    await expect(alertDetails.locator('[data-testid=\"conflict-resource\"]')).toContainText('Conference Room A');\n    await expect(alertDetails.locator('[data-testid=\"conflict-time\"]')).toContainText('10:00');\n    await expect(alertDetails.locator('[data-testid=\"conflict-date\"]')).toContainText('2024-03-15');\n    await expect(alertDetails.locator('[data-testid=\"existing-booking-info\"]')).toBeVisible();\n    await expect(alertDetails.locator('[data-testid=\"new-booking-info\"]')).toBeVisible();\n  });\n\n  test('Verify alert preference configuration and delivery', async ({ page }) => {\n    // Step 1: Scheduler sets alert preferences to email only\n    await page.click('[data-testid=\"user-menu-button\"]');\n    await page.click('[data-testid=\"alert-preferences-link\"]');\n    await expect(page.locator('[data-testid=\"alert-preferences-page\"]')).toBeVisible();\n    \n    // Uncheck all channels first\n    await page.uncheck('[data-testid=\"alert-channel-sms\"]');\n    await page.uncheck('[data-testid=\"alert-channel-inapp\"]');\n    // Check email only\n    await page.check('[data-testid=\"alert-channel-email\"]');\n    await page.click('[data-testid=\"save-preferences-button\"]');\n    \n    // Expected Result: Preferences saved successfully\n    await expect(page.locator('[data-testid=\"preferences-saved-message\"]')).toBeVisible();\n    await expect(page.locator('[data-testid=\"preferences-saved-message\"]')).toContainText('Preferences saved successfully');\n    \n    // Step 2: Trigger conflict detection\n    await page.goto('/scheduler/dashboard');\n    await page.click('[data-testid=\"create-booking-button\"]');\n    await page.fill('[data-testid=\"booking-resource-input\"]', 'Meeting Room B');\n    await page.fill('[data-testid=\"booking-date-input\"]', '2024-03-16');\n    await page.fill('[data-testid=\"booking-start-time-input\"]', '14:00');\n    await page.fill('[data-testid=\"booking-end-time-input\"]', '15:00');\n    await page.click('[data-testid=\"submit-booking-button\"]');\n    \n    // Expected Result: Alert sent via email only\n    await expect(page.locator('[data-testid=\"alert-notification\"]')).toBeVisible({ timeout: 5000 });\n    const alertChannelIndicator = page.locator('[data-testid=\"alert-channel-indicator\"]');\n    await expect(alertChannelIndicator).toContainText('Email');\n    await expect(alertChannelIndicator).not.toContainText('SMS');\n    await expect(alertChannelIndicator).not.toContainText('In-app');\n    \n    // Step 3: Change preferences to SMS and in-app\n    await page.click('[data-testid=\"user-menu-button\"]');\n    await page.click('[data-testid=\"alert-preferences-link\"]');\n    await page.uncheck('[data-testid=\"alert-channel-email\"]');\n    await page.check('[data-testid=\"alert-channel-sms\"]');\n    await page.check('[data-testid=\"alert-channel-inapp\"]');\n    await page.click('[data-testid=\"save-preferences-button\"]');\n    await expect(page.locator('[data-testid=\"preferences-saved-message\"]')).toBeVisible();\n    \n    // Create another conflicting booking\n    await page.goto('/scheduler/dashboard');\n    await page.click('[data-testid=\"create-booking-button\"]');\n    await page.fill('[data-testid=\"booking-resource-input\"]', 'Meeting Room B');\n    await page.fill('[data-testid=\"booking-date-input\"]', '2024-03-16');\n    await page.fill('[data-testid=\"booking-start-time-input\"]', '14:30');\n    await page.fill('[data-testid=\"booking-end-time-input\"]', '15:30');\n    await page.click('[data-testid=\"submit-booking-button\"]');\n    \n    // Expected Result: Alerts sent via SMS and in-app notifications\n    await expect(page.locator('[data-testid=\"alert-notification\"]')).toBeVisible({ timeout: 5000 });\n    const updatedChannelIndicator = page.locator('[data-testid=\"alert-channel-indicator\"]');\n    await expect(updatedChannelIndicator).toContainText('SMS');\n    await expect(updatedChannelIndicator).toContainText('In-app');\n    await expect(updatedChannelIndicator).not.toContainText('Email');\n  });\n\n  test('Ensure system retries failed alert deliveries', async ({ page, context }) => {\n    // Step 1: Simulate failure in email delivery\n    // Intercept API call and simulate failure\n    await page.route('**/api/alerts/send', async (route) => {\n      const request = route.request();\n      if (request.method() === 'POST') {\n        // First attempt fails\n        await route.fulfill({\n          status: 500,\n          body: JSON.stringify({ error: 'Email delivery failed' })\n        });\n      }\n    });\n    \n    await page.click('[data-testid=\"create-booking-button\"]');\n    await page.fill('[data-testid=\"booking-resource-input\"]', 'Training Room C');\n    await page.fill('[data-testid=\"booking-date-input\"]', '2024-03-17');\n    await page.fill('[data-testid=\"booking-start-time-input\"]', '09:00');\n    await page.fill('[data-testid=\"booking-end-time-input\"]', '10:00');\n    await page.click('[data-testid=\"submit-booking-button\"]');\n    \n    // Expected Result: Initial alert delivery fails\n    await expect(page.locator('[data-testid=\"conflict-detected-indicator\"]')).toBeVisible({ timeout: 3000 });\n    await page.waitForTimeout(2000); // Wait for initial delivery attempt\n    \n    // Step 2: System retries sending alert\n    // Remove route interception to allow successful delivery\n    await page.unroute('**/api/alerts/send');\n    \n    // Wait for retry mechanism (system should retry automatically)\n    await page.waitForTimeout(3000);\n    \n    // Expected Result: Alert successfully delivered on retry\n    await expect(page.locator('[data-testid=\"alert-notification\"]')).toBeVisible({ timeout: 10000 });\n    await expect(page.locator('[data-testid=\"alert-delivery-status\"]')).toContainText('Delivered');\n    \n    // Step 3: Check alert delivery logs\n    await page.click('[data-testid=\"user-menu-button\"]');\n    await page.click('[data-testid=\"alert-logs-link\"]');\n    await expect(page.locator('[data-testid=\"alert-logs-page\"]')).toBeVisible();\n    \n    // Filter for recent alert\n    const recentAlert = page.locator('[data-testid=\"alert-log-entry\"]').first();\n    await recentAlert.click();\n    \n    // Expected Result: Retry attempts and success logged\n    const logDetails = page.locator('[data-testid=\"alert-log-details\"]');\n    await expect(logDetails).toBeVisible();\n    await expect(logDetails.locator('[data-testid=\"delivery-attempts\"]')).toContainText('2');\n    await expect(logDetails.locator('[data-testid=\"first-attempt-status\"]')).toContainText('Failed');\n    await expect(logDetails.locator('[data-testid=\"retry-attempt-status\"]')).toContainText('Success');\n    await expect(logDetails.locator('[data-testid=\"final-status\"]')).toContainText('Delivered');\n    await expect(logDetails.locator('[data-testid=\"retry-timestamp\"]')).toBeVisible();\n  });\n});"
    }
  ]
}