json
{
  "success": true,
  "playwrightTests": [
    {
      "storyId": "story-16",
      "storyTitle": "As Scheduler, I want to receive alerts only for conflicts relevant to my assigned resources to reduce noise",
      "testFile": "scheduler-alert-filtering.spec.ts",
      "testCode": "import { test, expect } from '@playwright/test';\n\ntest.describe('Story-16: Scheduler Alert Filtering by Assigned Resources', () => {\n  const BASE_URL = process.env.BASE_URL || 'http://localhost:3000';\n  const SCHEDULER_EMAIL = 'scheduler@test.com';\n  const SCHEDULER_PASSWORD = 'Test123!';\n\n  test.beforeEach(async ({ page }) => {\n    // Login as scheduler\n    await page.goto(`${BASE_URL}/login`);\n    await page.fill('[data-testid=\"email-input\"]', SCHEDULER_EMAIL);\n    await page.fill('[data-testid=\"password-input\"]', SCHEDULER_PASSWORD);\n    await page.click('[data-testid=\"login-button\"]');\n    await expect(page).toHaveURL(/.*dashboard/);\n  });\n\n  test('Verify alert filtering by assigned resources (happy-path)', async ({ page }) => {\n    // Step 1: Navigate to resource assignment settings and assign specific resources\n    await page.goto(`${BASE_URL}/settings/resource-assignments`);\n    await expect(page.locator('[data-testid=\"resource-assignments-page\"]')).toBeVisible();\n    \n    // Clear existing assignments\n    const existingAssignments = page.locator('[data-testid=\"assigned-resource-item\"]');\n    const count = await existingAssignments.count();\n    for (let i = 0; i < count; i++) {\n      await page.click('[data-testid=\"remove-resource-button\"]').first();\n    }\n    \n    // Assign Conference Room A\n    await page.click('[data-testid=\"add-resource-button\"]');\n    await page.selectOption('[data-testid=\"resource-select\"]', { label: 'Conference Room A' });\n    await page.click('[data-testid=\"confirm-add-resource\"]');\n    await expect(page.locator('text=Conference Room A')).toBeVisible();\n    \n    // Assign Projector 1\n    await page.click('[data-testid=\"add-resource-button\"]');\n    await page.selectOption('[data-testid=\"resource-select\"]', { label: 'Projector 1' });\n    await page.click('[data-testid=\"confirm-add-resource\"]');\n    await expect(page.locator('text=Projector 1')).toBeVisible();\n    \n    // Save assignments\n    await page.click('[data-testid=\"save-assignments-button\"]');\n    await expect(page.locator('[data-testid=\"success-message\"]')).toContainText('Assignments saved successfully');\n    \n    // Step 2: Create conflicting bookings for assigned and unassigned resources\n    await page.goto(`${BASE_URL}/bookings/create`);\n    \n    // Create conflict for assigned resource (Conference Room A)\n    await page.fill('[data-testid=\"booking-title\"]', 'Meeting A - Slot 1');\n    await page.selectOption('[data-testid=\"resource-dropdown\"]', { label: 'Conference Room A' });\n    await page.fill('[data-testid=\"start-time\"]', '2024-03-15T10:00');\n    await page.fill('[data-testid=\"end-time\"]', '2024-03-15T11:00');\n    await page.click('[data-testid=\"create-booking-button\"]');\n    await expect(page.locator('[data-testid=\"booking-success\"]')).toBeVisible();\n    \n    // Create overlapping booking for Conference Room A\n    await page.goto(`${BASE_URL}/bookings/create`);\n    await page.fill('[data-testid=\"booking-title\"]', 'Meeting A - Slot 2');\n    await page.selectOption('[data-testid=\"resource-dropdown\"]', { label: 'Conference Room A' });\n    await page.fill('[data-testid=\"start-time\"]', '2024-03-15T10:30');\n    await page.fill('[data-testid=\"end-time\"]', '2024-03-15T11:30');\n    await page.click('[data-testid=\"create-booking-button\"]');\n    \n    // Create conflict for unassigned resource (Conference Room B)\n    await page.goto(`${BASE_URL}/bookings/create`);\n    await page.fill('[data-testid=\"booking-title\"]', 'Meeting B - Slot 1');\n    await page.selectOption('[data-testid=\"resource-dropdown\"]', { label: 'Conference Room B' });\n    await page.fill('[data-testid=\"start-time\"]', '2024-03-15T14:00');\n    await page.fill('[data-testid=\"end-time\"]', '2024-03-15T15:00');\n    await page.click('[data-testid=\"create-booking-button\"]');\n    await expect(page.locator('[data-testid=\"booking-success\"]')).toBeVisible();\n    \n    // Create overlapping booking for Conference Room B\n    await page.goto(`${BASE_URL}/bookings/create`);\n    await page.fill('[data-testid=\"booking-title\"]', 'Meeting B - Slot 2');\n    await page.selectOption('[data-testid=\"resource-dropdown\"]', { label: 'Conference Room B' });\n    await page.fill('[data-testid=\"start-time\"]', '2024-03-15T14:30');\n    await page.fill('[data-testid=\"end-time\"]', '2024-03-15T15:30');\n    await page.click('[data-testid=\"create-booking-button\"]');\n    \n    // Verify received alerts\n    await page.goto(`${BASE_URL}/alerts`);\n    await page.waitForTimeout(2000); // Wait for alert processing\n    \n    const alerts = page.locator('[data-testid=\"alert-item\"]');\n    await expect(alerts).toHaveCount(1);\n    \n    const alertContent = await alerts.first().textContent();\n    expect(alertContent).toContain('Conference Room A');\n    expect(alertContent).not.toContain('Conference Room B');\n    \n    // Step 3: Update resource assignments\n    await page.goto(`${BASE_URL}/settings/resource-assignments`);\n    \n    // Remove Conference Room A\n    const conferenceRoomA = page.locator('[data-testid=\"assigned-resource-item\"]', { hasText: 'Conference Room A' });\n    await conferenceRoomA.locator('[data-testid=\"remove-resource-button\"]').click();\n    await expect(page.locator('text=Conference Room A')).not.toBeVisible();\n    \n    // Add Conference Room B\n    await page.click('[data-testid=\"add-resource-button\"]');\n    await page.selectOption('[data-testid=\"resource-select\"]', { label: 'Conference Room B' });\n    await page.click('[data-testid=\"confirm-add-resource\"]');\n    await expect(page.locator('text=Conference Room B')).toBeVisible();\n    \n    // Save updated assignments\n    await page.click('[data-testid=\"save-assignments-button\"]');\n    await expect(page.locator('[data-testid=\"success-message\"]')).toContainText('Assignments saved successfully');\n    \n    // Clear existing alerts\n    await page.goto(`${BASE_URL}/alerts`);\n    const clearAllButton = page.locator('[data-testid=\"clear-all-alerts-button\"]');\n    if (await clearAllButton.isVisible()) {\n      await clearAllButton.click();\n    }\n    \n    // Create new conflicts for both rooms\n    await page.goto(`${BASE_URL}/bookings/create`);\n    await page.fill('[data-testid=\"booking-title\"]', 'Meeting A - Slot 3');\n    await page.selectOption('[data-testid=\"resource-dropdown\"]', { label: 'Conference Room A' });\n    await page.fill('[data-testid=\"start-time\"]', '2024-03-15T16:00');\n    await page.fill('[data-testid=\"end-time\"]', '2024-03-15T17:00');\n    await page.click('[data-testid=\"create-booking-button\"]');\n    \n    await page.goto(`${BASE_URL}/bookings/create`);\n    await page.fill('[data-testid=\"booking-title\"]', 'Meeting A - Slot 4');\n    await page.selectOption('[data-testid=\"resource-dropdown\"]', { label: 'Conference Room A' });\n    await page.fill('[data-testid=\"start-time\"]', '2024-03-15T16:30');\n    await page.fill('[data-testid=\"end-time\"]', '2024-03-15T17:30');\n    await page.click('[data-testid=\"create-booking-button\"]');\n    \n    await page.goto(`${BASE_URL}/bookings/create`);\n    await page.fill('[data-testid=\"booking-title\"]', 'Meeting B - Slot 3');\n    await page.selectOption('[data-testid=\"resource-dropdown\"]', { label: 'Conference Room B' });\n    await page.fill('[data-testid=\"start-time\"]', '2024-03-15T16:00');\n    await page.fill('[data-testid=\"end-time\"]', '2024-03-15T17:00');\n    await page.click('[data-testid=\"create-booking-button\"]');\n    \n    await page.goto(`${BASE_URL}/bookings/create`);\n    await page.fill('[data-testid=\"booking-title\"]', 'Meeting B - Slot 4');\n    await page.selectOption('[data-testid=\"resource-dropdown\"]', { label: 'Conference Room B' });\n    await page.fill('[data-testid=\"start-time\"]', '2024-03-15T16:30');\n    await page.fill('[data-testid=\"end-time\"]', '2024-03-15T17:30');\n    await page.click('[data-testid=\"create-booking-button\"]');\n    \n    // Verify alert filtering updates accordingly\n    await page.goto(`${BASE_URL}/alerts`);\n    await page.waitForTimeout(2000);\n    \n    const updatedAlerts = page.locator('[data-testid=\"alert-item\"]');\n    await expect(updatedAlerts).toHaveCount(1);\n    \n    const updatedAlertContent = await updatedAlerts.first().textContent();\n    expect(updatedAlertContent).toContain('Conference Room B');\n    expect(updatedAlertContent).not.toContain('Conference Room A');\n  });\n\n  test('Test override of filtering for critical alerts (edge-case)', async ({ page }) => {\n    // Step 1: Verify scheduler's current resource assignments\n    await page.goto(`${BASE_URL}/settings/resource-assignments`);\n    await expect(page.locator('[data-testid=\"resource-assignments-page\"]')).toBeVisible();\n    \n    // Ensure Emergency Equipment is not assigned\n    const assignedResources = page.locator('[data-testid=\"assigned-resource-item\"]');\n    const resourceTexts = await assignedResources.allTextContents();\n    expect(resourceTexts.join(' ')).not.toContain('Emergency Equipment');\n    \n    // Clear all alerts before test\n    await page.goto(`${BASE_URL}/alerts`);\n    const clearAllButton = page.locator('[data-testid=\"clear-all-alerts-button\"]');\n    if (await clearAllButton.isVisible()) {\n      await clearAllButton.click();\n    }\n    \n    // Step 2: Create a critical conflict involving unassigned resource\n    await page.goto(`${BASE_URL}/bookings/create`);\n    await page.fill('[data-testid=\"booking-title\"]', 'Emergency Equipment Usage 1');\n    await page.selectOption('[data-testid=\"resource-dropdown\"]', { label: 'Emergency Equipment' });\n    await page.fill('[data-testid=\"start-time\"]', '2024-03-16T09:00');\n    await page.fill('[data-testid=\"end-time\"]', '2024-03-16T10:00');\n    await page.check('[data-testid=\"critical-priority-checkbox\"]');\n    await page.click('[data-testid=\"create-booking-button\"]');\n    await expect(page.locator('[data-testid=\"booking-success\"]')).toBeVisible();\n    \n    // Create overlapping critical booking\n    await page.goto(`${BASE_URL}/bookings/create`);\n    await page.fill('[data-testid=\"booking-title\"]', 'Emergency Equipment Usage 2');\n    await page.selectOption('[data-testid=\"resource-dropdown\"]', { label: 'Emergency Equipment' });\n    await page.fill('[data-testid=\"start-time\"]', '2024-03-16T09:30');\n    await page.fill('[data-testid=\"end-time\"]', '2024-03-16T10:30');\n    await page.check('[data-testid=\"critical-priority-checkbox\"]');\n    await page.click('[data-testid=\"create-booking-button\"]');\n    \n    // Step 3: Monitor notification channels for alert delivery\n    await page.goto(`${BASE_URL}/alerts`);\n    await page.waitForTimeout(2000); // Wait for alert processing\n    \n    const criticalAlerts = page.locator('[data-testid=\"alert-item\"]');\n    await expect(criticalAlerts).toHaveCountGreaterThan(0);\n    \n    // Step 4: Verify alert content indicates override reason\n    const criticalAlert = criticalAlerts.first();\n    await expect(criticalAlert).toBeVisible();\n    \n    const alertContent = await criticalAlert.textContent();\n    expect(alertContent).toContain('Emergency Equipment');\n    \n    // Verify critical override indicator\n    const criticalBadge = criticalAlert.locator('[data-testid=\"critical-override-badge\"]');\n    await expect(criticalBadge).toBeVisible();\n    await expect(criticalBadge).toContainText(/critical|override/i);\n    \n    // Verify alert metadata\n    await criticalAlert.click();\n    await expect(page.locator('[data-testid=\"alert-details-modal\"]')).toBeVisible();\n    \n    const overrideReason = page.locator('[data-testid=\"override-reason\"]');\n    await expect(overrideReason).toBeVisible();\n    await expect(overrideReason).toContainText(/critical alert override|high priority/i);\n    \n    const alertPriority = page.locator('[data-testid=\"alert-priority\"]');\n    await expect(alertPriority).toContainText(/critical|high/i);\n  });\n});"
    }
  ]
}