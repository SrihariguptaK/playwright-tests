json
{
  "success": true,
  "playwrightTests": [
    {
      "storyId": "story-18",
      "storyTitle": "As Scheduler, I want the system to support multiple alert channels including email, SMS, and in-app notifications to ensure timely awareness",
      "testFile": "multi-channel-alerts.spec.ts",
      "testCode": "import { test, expect } from '@playwright/test';\n\ntest.describe('Story-18: Multi-Channel Alert System', () => {\n  const testEmail = 'scheduler@example.com';\n  const testPhone = '+1234567890';\n  const baseURL = process.env.BASE_URL || 'http://localhost:3000';\n\n  test.beforeEach(async ({ page }) => {\n    // Navigate to application and login\n    await page.goto(baseURL);\n    await page.fill('[data-testid=\"username-input\"]', 'scheduler_user');\n    await page.fill('[data-testid=\"password-input\"]', 'password123');\n    await page.click('[data-testid=\"login-button\"]');\n    await expect(page.locator('[data-testid=\"dashboard\"]')).toBeVisible();\n  });\n\n  test('Validate multi-channel alert delivery', async ({ page }) => {\n    // Step 1: Navigate to user profile settings and access alert preferences section\n    await page.click('[data-testid=\"user-profile-menu\"]');\n    await page.click('[data-testid=\"settings-link\"]');\n    await expect(page.locator('[data-testid=\"settings-page\"]')).toBeVisible();\n    await page.click('[data-testid=\"alert-preferences-tab\"]');\n    await expect(page.locator('[data-testid=\"alert-preferences-section\"]')).toBeVisible();\n\n    // Step 2: Select email checkbox and enter/verify email address\n    await page.check('[data-testid=\"email-alert-checkbox\"]');\n    await expect(page.locator('[data-testid=\"email-alert-checkbox\"]')).toBeChecked();\n    await page.fill('[data-testid=\"email-address-input\"]', testEmail);\n    await expect(page.locator('[data-testid=\"email-address-input\"]')).toHaveValue(testEmail);\n\n    // Step 3: Select SMS checkbox and enter/verify phone number\n    await page.check('[data-testid=\"sms-alert-checkbox\"]');\n    await expect(page.locator('[data-testid=\"sms-alert-checkbox\"]')).toBeChecked();\n    await page.fill('[data-testid=\"phone-number-input\"]', testPhone);\n    await expect(page.locator('[data-testid=\"phone-number-input\"]')).toHaveValue(testPhone);\n\n    // Step 4: Select in-app notification checkbox\n    await page.check('[data-testid=\"inapp-alert-checkbox\"]');\n    await expect(page.locator('[data-testid=\"inapp-alert-checkbox\"]')).toBeChecked();\n\n    // Step 5: Click 'Save Preferences' button\n    await page.click('[data-testid=\"save-preferences-button\"]');\n    await expect(page.locator('[data-testid=\"success-message\"]')).toBeVisible();\n    await expect(page.locator('[data-testid=\"success-message\"]')).toContainText('Preferences saved successfully');\n\n    // Step 6: Trigger conflict detection by creating a scheduling conflict\n    await page.goto(`${baseURL}/schedule`);\n    await page.click('[data-testid=\"create-schedule-button\"]');\n    await page.fill('[data-testid=\"resource-name-input\"]', 'Conference Room A');\n    await page.fill('[data-testid=\"start-time-input\"]', '2024-01-15T10:00');\n    await page.fill('[data-testid=\"end-time-input\"]', '2024-01-15T11:00');\n    await page.click('[data-testid=\"submit-schedule-button\"]');\n    \n    // Create conflicting schedule\n    await page.click('[data-testid=\"create-schedule-button\"]');\n    await page.fill('[data-testid=\"resource-name-input\"]', 'Conference Room A');\n    await page.fill('[data-testid=\"start-time-input\"]', '2024-01-15T10:30');\n    await page.fill('[data-testid=\"end-time-input\"]', '2024-01-15T11:30');\n    await page.click('[data-testid=\"submit-schedule-button\"]');\n    \n    // Expected Result: Alerts sent via all selected channels\n    await expect(page.locator('[data-testid=\"conflict-detected-message\"]')).toBeVisible({ timeout: 10000 });\n\n    // Step 7: Check in-app notification center\n    await page.click('[data-testid=\"notification-bell-icon\"]');\n    await expect(page.locator('[data-testid=\"notification-panel\"]')).toBeVisible();\n    const inAppAlert = page.locator('[data-testid=\"alert-notification\"]').first();\n    await expect(inAppAlert).toBeVisible();\n    await expect(inAppAlert).toContainText('Scheduling conflict detected');\n    \n    // Verify timestamp is present\n    const timestamp = await inAppAlert.locator('[data-testid=\"alert-timestamp\"]').textContent();\n    expect(timestamp).toBeTruthy();\n\n    // Step 8: Verify alert delivery status in dashboard\n    await page.goto(`${baseURL}/alerts/delivery-status`);\n    await expect(page.locator('[data-testid=\"delivery-status-page\"]')).toBeVisible();\n    \n    const emailStatus = page.locator('[data-testid=\"email-delivery-status\"]').first();\n    await expect(emailStatus).toContainText('Delivered');\n    \n    const smsStatus = page.locator('[data-testid=\"sms-delivery-status\"]').first();\n    await expect(smsStatus).toContainText('Delivered');\n    \n    const inAppStatus = page.locator('[data-testid=\"inapp-delivery-status\"]').first();\n    await expect(inAppStatus).toContainText('Delivered');\n\n    // Verify delivery time is within 5 seconds\n    const deliveryTime = await page.locator('[data-testid=\"delivery-time\"]').first().textContent();\n    expect(deliveryTime).toBeTruthy();\n  });\n\n  test('Test alert delivery retry on failure', async ({ page }) => {\n    // Step 1: Configure test environment to simulate SMS delivery failure\n    await page.goto(`${baseURL}/admin/test-settings`);\n    await expect(page.locator('[data-testid=\"test-settings-page\"]')).toBeVisible();\n    await page.check('[data-testid=\"simulate-sms-failure-checkbox\"]');\n    await expect(page.locator('[data-testid=\"simulate-sms-failure-checkbox\"]')).toBeChecked();\n    await page.click('[data-testid=\"save-test-settings-button\"]');\n    await expect(page.locator('[data-testid=\"settings-saved-message\"]')).toBeVisible();\n\n    // Step 2: Trigger conflict detection to generate an alert\n    await page.goto(`${baseURL}/schedule`);\n    await page.click('[data-testid=\"create-schedule-button\"]');\n    await page.fill('[data-testid=\"resource-name-input\"]', 'Meeting Room B');\n    await page.fill('[data-testid=\"start-time-input\"]', '2024-01-16T14:00');\n    await page.fill('[data-testid=\"end-time-input\"]', '2024-01-16T15:00');\n    await page.click('[data-testid=\"submit-schedule-button\"]');\n    \n    // Create conflicting schedule\n    await page.click('[data-testid=\"create-schedule-button\"]');\n    await page.fill('[data-testid=\"resource-name-input\"]', 'Meeting Room B');\n    await page.fill('[data-testid=\"start-time-input\"]', '2024-01-16T14:30');\n    await page.fill('[data-testid=\"end-time-input\"]', '2024-01-16T15:30');\n    await page.click('[data-testid=\"submit-schedule-button\"]');\n\n    // Expected Result: Initial SMS delivery fails\n    await expect(page.locator('[data-testid=\"conflict-detected-message\"]')).toBeVisible({ timeout: 10000 });\n\n    // Step 3: Access delivery logs and verify failure is recorded\n    await page.goto(`${baseURL}/alerts/delivery-logs`);\n    await expect(page.locator('[data-testid=\"delivery-logs-page\"]')).toBeVisible();\n    \n    const failedSmsLog = page.locator('[data-testid=\"delivery-log-entry\"]').filter({ hasText: 'SMS' }).first();\n    await expect(failedSmsLog).toBeVisible();\n    await expect(failedSmsLog.locator('[data-testid=\"delivery-status\"]')).toContainText('Failed');\n    await expect(failedSmsLog.locator('[data-testid=\"failure-reason\"]')).toBeVisible();\n\n    // Step 4: Remove SMS delivery failure simulation\n    await page.goto(`${baseURL}/admin/test-settings`);\n    await page.uncheck('[data-testid=\"simulate-sms-failure-checkbox\"]');\n    await expect(page.locator('[data-testid=\"simulate-sms-failure-checkbox\"]')).not.toBeChecked();\n    await page.click('[data-testid=\"save-test-settings-button\"]');\n    await expect(page.locator('[data-testid=\"settings-saved-message\"]')).toBeVisible();\n\n    // Step 5: Wait for system to automatically retry SMS delivery\n    await page.goto(`${baseURL}/alerts/delivery-logs`);\n    await page.waitForTimeout(6000); // Wait for retry mechanism\n    await page.reload();\n\n    // Step 6: Verify SMS alert is delivered successfully on retry\n    const retriedSmsLog = page.locator('[data-testid=\"delivery-log-entry\"]').filter({ hasText: 'SMS' }).first();\n    await expect(retriedSmsLog.locator('[data-testid=\"delivery-status\"]')).toContainText('Delivered', { timeout: 15000 });\n\n    // Step 7: Check retry attempts in logs\n    await retriedSmsLog.click();\n    await expect(page.locator('[data-testid=\"log-details-panel\"]')).toBeVisible();\n    const retryCount = page.locator('[data-testid=\"retry-count\"]');\n    await expect(retryCount).toBeVisible();\n    const retryCountText = await retryCount.textContent();\n    expect(parseInt(retryCountText || '0')).toBeGreaterThan(0);\n\n    // Step 8: Verify retry attempts and success logged\n    const retryHistory = page.locator('[data-testid=\"retry-history\"]');\n    await expect(retryHistory).toBeVisible();\n    await expect(retryHistory.locator('[data-testid=\"retry-attempt\"]').first()).toContainText('Failed');\n    await expect(retryHistory.locator('[data-testid=\"retry-attempt\"]').last()).toContainText('Success');\n\n    // Step 9: Verify delivery status in alert dashboard\n    await page.goto(`${baseURL}/alerts/dashboard`);\n    await expect(page.locator('[data-testid=\"alert-dashboard\"]')).toBeVisible();\n    const alertEntry = page.locator('[data-testid=\"alert-entry\"]').first();\n    await expect(alertEntry.locator('[data-testid=\"sms-status\"]')).toContainText('Delivered');\n    await expect(alertEntry.locator('[data-testid=\"retry-indicator\"]')).toBeVisible();\n  });\n});"
    }
  ]
}