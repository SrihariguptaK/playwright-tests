json
{
  "success": true,
  "playwrightTests": [
    {
      "storyId": "story-4",
      "storyTitle": "As Scheduling Manager, I want to generate employee schedules using shift templates to achieve efficient workforce planning",
      "testFile": "schedule-generation.spec.ts",
      "testCode": "import { test, expect } from '@playwright/test';\n\ntest.describe('Schedule Generation - Story 4', () => {\n  test.beforeEach(async ({ page }) => {\n    // Login as Scheduling Manager\n    await page.goto('/login');\n    await page.fill('[data-testid=\"username-input\"]', 'scheduling.manager@company.com');\n    await page.fill('[data-testid=\"password-input\"]', 'SecurePass123');\n    await page.click('[data-testid=\"login-button\"]');\n    await expect(page).toHaveURL(/.*dashboard/);\n  });\n\n  test('Generate schedule with valid shift templates and employee assignments', async ({ page }) => {\n    // Step 1: Navigate to schedule generation page\n    await page.click('[data-testid=\"main-menu\"]');\n    await page.click('text=Schedule Generation');\n    await expect(page.locator('[data-testid=\"schedule-generation-form\"]')).toBeVisible();\n    await expect(page.locator('h1')).toContainText('Generate Schedule');\n\n    // Step 2: Select valid date range and shift templates\n    // Select date range - next week Monday to Sunday\n    const nextMonday = new Date();\n    nextMonday.setDate(nextMonday.getDate() + ((1 + 7 - nextMonday.getDay()) % 7));\n    const nextSunday = new Date(nextMonday);\n    nextSunday.setDate(nextMonday.getDate() + 6);\n\n    await page.fill('[data-testid=\"start-date-picker\"]', nextMonday.toISOString().split('T')[0]);\n    await page.fill('[data-testid=\"end-date-picker\"]', nextSunday.toISOString().split('T')[0]);\n    \n    // Verify date selections accepted without errors\n    await expect(page.locator('[data-testid=\"date-range-error\"]')).not.toBeVisible();\n\n    // Select shift templates from dropdown\n    await page.click('[data-testid=\"shift-template-dropdown\"]');\n    await page.click('[data-testid=\"shift-template-option-morning\"]');\n    await page.click('[data-testid=\"shift-template-option-evening\"]');\n    await expect(page.locator('[data-testid=\"selected-templates\"]')).toContainText('Morning Shift');\n    await expect(page.locator('[data-testid=\"selected-templates\"]')).toContainText('Evening Shift');\n\n    // Step 3: Assign employees to shifts ensuring availability\n    // Assign employee to morning shift\n    await page.click('[data-testid=\"shift-morning-assign-button\"]');\n    await page.click('[data-testid=\"employee-list\"]');\n    await page.click('[data-testid=\"employee-option-john-doe\"]');\n    \n    // Verify employee availability and role compatibility\n    await expect(page.locator('[data-testid=\"employee-john-doe-status\"]')).toContainText('Available');\n    await expect(page.locator('[data-testid=\"employee-john-doe-role\"]')).toContainText('Compatible');\n    await expect(page.locator('[data-testid=\"assignment-validation-success\"]')).toBeVisible();\n\n    // Assign employee to evening shift\n    await page.click('[data-testid=\"shift-evening-assign-button\"]');\n    await page.click('[data-testid=\"employee-list\"]');\n    await page.click('[data-testid=\"employee-option-jane-smith\"]');\n    \n    await expect(page.locator('[data-testid=\"employee-jane-smith-status\"]')).toContainText('Available');\n    await expect(page.locator('[data-testid=\"assignment-validation-success\"]')).toBeVisible();\n\n    // Step 4: Submit schedule generation\n    await page.click('[data-testid=\"generate-schedule-button\"]');\n    \n    // Wait for schedule generation to complete\n    await expect(page.locator('[data-testid=\"schedule-generation-progress\"]')).toBeVisible();\n    await expect(page.locator('[data-testid=\"schedule-generation-success\"]')).toBeVisible({ timeout: 10000 });\n    \n    // Verify confirmation displayed\n    await expect(page.locator('[data-testid=\"confirmation-message\"]')).toContainText('Schedule generated successfully');\n    await expect(page.locator('[data-testid=\"schedule-id\"]')).toBeVisible();\n    \n    // Verify generated schedule is displayed\n    await expect(page.locator('[data-testid=\"generated-schedule-view\"]')).toBeVisible();\n    await expect(page.locator('[data-testid=\"schedule-employee-john-doe\"]')).toBeVisible();\n    await expect(page.locator('[data-testid=\"schedule-employee-jane-smith\"]')).toBeVisible();\n  });\n\n  test('Prevent double-booking of employees during schedule generation', async ({ page }) => {\n    // Navigate to schedule generation page\n    await page.click('[data-testid=\"main-menu\"]');\n    await page.click('text=Schedule Generation');\n    await expect(page.locator('[data-testid=\"schedule-generation-form\"]')).toBeVisible();\n\n    // Select date range that includes overlapping shift times\n    const startDate = new Date();\n    startDate.setDate(startDate.getDate() + 7);\n    const endDate = new Date(startDate);\n    endDate.setDate(startDate.getDate() + 1);\n\n    await page.fill('[data-testid=\"start-date-picker\"]', startDate.toISOString().split('T')[0]);\n    await page.fill('[data-testid=\"end-date-picker\"]', endDate.toISOString().split('T')[0]);\n\n    // Step 1: Select two shift templates with overlapping time periods\n    // Shift A: 9 AM - 5 PM\n    await page.click('[data-testid=\"shift-template-dropdown\"]');\n    await page.click('[data-testid=\"shift-template-option-day-shift\"]');\n    await expect(page.locator('[data-testid=\"shift-day-shift-time\"]')).toContainText('9:00 AM - 5:00 PM');\n\n    // Shift B: 3 PM - 11 PM (overlapping with Shift A)\n    await page.click('[data-testid=\"shift-template-dropdown\"]');\n    await page.click('[data-testid=\"shift-template-option-afternoon-shift\"]');\n    await expect(page.locator('[data-testid=\"shift-afternoon-shift-time\"]')).toContainText('3:00 PM - 11:00 PM');\n\n    // Assign the same employee to the first shift\n    await page.click('[data-testid=\"shift-day-shift-assign-button\"]');\n    await page.click('[data-testid=\"employee-list\"]');\n    await page.click('[data-testid=\"employee-option-mike-johnson\"]');\n    await expect(page.locator('[data-testid=\"shift-day-shift-assigned-employees\"]')).toContainText('Mike Johnson');\n\n    // Attempt to assign the same employee to overlapping shift\n    await page.click('[data-testid=\"shift-afternoon-shift-assign-button\"]');\n    await page.click('[data-testid=\"employee-list\"]');\n    await page.click('[data-testid=\"employee-option-mike-johnson\"]');\n\n    // Expected Result: Validation error displayed preventing assignment\n    await expect(page.locator('[data-testid=\"validation-error\"]')).toBeVisible();\n    await expect(page.locator('[data-testid=\"validation-error\"]')).toContainText('Employee is already assigned to an overlapping shift');\n    await expect(page.locator('[data-testid=\"double-booking-warning\"]')).toBeVisible();\n    await expect(page.locator('[data-testid=\"double-booking-warning\"]')).toContainText('Mike Johnson');\n\n    // Step 2: Attempt to generate schedule with conflicting assignments\n    await page.click('[data-testid=\"generate-schedule-button\"]');\n\n    // Expected Result: Schedule generation blocked with error messages\n    await expect(page.locator('[data-testid=\"schedule-generation-error\"]')).toBeVisible();\n    await expect(page.locator('[data-testid=\"schedule-generation-error\"]')).toContainText('Cannot generate schedule');\n    await expect(page.locator('[data-testid=\"conflict-error-message\"]')).toContainText('conflicting assignments');\n    await expect(page.locator('[data-testid=\"conflict-details\"]')).toContainText('Mike Johnson has overlapping shift assignments');\n    \n    // Verify schedule was not created\n    await expect(page.locator('[data-testid=\"schedule-generation-success\"]')).not.toBeVisible();\n    await expect(page.locator('[data-testid=\"confirmation-message\"]')).not.toBeVisible();\n    \n    // Verify error details are displayed\n    await expect(page.locator('[data-testid=\"error-list\"]')).toBeVisible();\n    await expect(page.locator('[data-testid=\"error-item-double-booking\"]')).toBeVisible();\n  });\n});"
    }
  ]
}