json
{
  "success": true,
  "playwrightTests": [
    {
      "storyId": "story-9",
      "storyTitle": "As Scheduling Manager, I want to receive notifications about schedule changes to stay informed",
      "testFile": "schedule-notifications.spec.ts",
      "testCode": "import { test, expect } from '@playwright/test';\n\ntest.describe('Schedule Notifications - Story 9', () => {\n  test.beforeEach(async ({ page }) => {\n    // Login as Scheduling Manager\n    await page.goto('/login');\n    await page.fill('[data-testid=\"email-input\"]', 'scheduling.manager@example.com');\n    await page.fill('[data-testid=\"password-input\"]', 'SecurePass123!');\n    await page.click('[data-testid=\"login-button\"]');\n    await expect(page).toHaveURL(/.*dashboard/);\n  });\n\n  test('Receive notification on schedule creation', async ({ page }) => {\n    // Step 1: Navigate to the schedule creation page\n    await page.goto('/schedules/create');\n    await expect(page.locator('[data-testid=\"schedule-creation-form\"]')).toBeVisible();\n\n    // Step 2: Fill in all required schedule details\n    await page.fill('[data-testid=\"schedule-date-input\"]', '2024-02-15');\n    await page.fill('[data-testid=\"schedule-time-start\"]', '09:00');\n    await page.fill('[data-testid=\"schedule-time-end\"]', '17:00');\n    await page.fill('[data-testid=\"schedule-location-input\"]', 'Main Office - Building A');\n    \n    // Assign at least one employee\n    await page.click('[data-testid=\"assign-employee-button\"]');\n    await page.fill('[data-testid=\"employee-search-input\"]', 'John Doe');\n    await page.click('[data-testid=\"employee-option-john-doe\"]');\n    await page.click('[data-testid=\"confirm-employee-assignment\"]');\n\n    // Step 3: Click 'Save' or 'Create Schedule' button\n    await page.click('[data-testid=\"create-schedule-button\"]');\n    \n    // Expected Result: Schedule saved successfully\n    await expect(page.locator('[data-testid=\"success-message\"]')).toContainText('Schedule saved successfully');\n    \n    // Step 4: Wait up to 1 minute and check notification delivery\n    await page.waitForTimeout(5000); // Simulate waiting for notification processing\n    \n    // Navigate to notification logs in system administration panel\n    await page.goto('/admin/notification-logs');\n    await expect(page.locator('[data-testid=\"notification-logs-table\"]')).toBeVisible();\n    \n    // Expected Result: Notifications received via email and system alerts\n    const latestNotification = page.locator('[data-testid=\"notification-log-row\"]').first();\n    await expect(latestNotification).toBeVisible();\n    await expect(latestNotification.locator('[data-testid=\"notification-type\"]')).toContainText('Schedule Creation');\n    await expect(latestNotification.locator('[data-testid=\"notification-recipient\"]')).toContainText('John Doe');\n    await expect(latestNotification.locator('[data-testid=\"notification-channels\"]')).toContainText('Email');\n    await expect(latestNotification.locator('[data-testid=\"notification-channels\"]')).toContainText('System Alert');\n    \n    // Expected Result: Notification delivery logged without errors\n    await expect(latestNotification.locator('[data-testid=\"notification-status\"]')).toContainText('Delivered');\n    await expect(latestNotification.locator('[data-testid=\"notification-errors\"]')).toContainText('None');\n    \n    // Verify system alerts panel for assigned employee\n    await page.goto('/notifications');\n    const systemAlert = page.locator('[data-testid=\"system-alert-item\"]').first();\n    await expect(systemAlert).toBeVisible();\n    await expect(systemAlert).toContainText('New schedule created');\n    await expect(systemAlert).toContainText('2024-02-15');\n  });\n\n  test('Configure and receive notifications based on preferences', async ({ page }) => {\n    // Step 1: Navigate to user profile or settings page\n    await page.goto('/profile/settings');\n    await expect(page.locator('[data-testid=\"settings-page\"]')).toBeVisible();\n    \n    // Step 2: Locate and click on 'Notification Preferences'\n    await page.click('[data-testid=\"notification-preferences-tab\"]');\n    await expect(page.locator('[data-testid=\"notification-preferences-section\"]')).toBeVisible();\n    \n    // Step 3: Update notification preferences\n    // Enable email only, disable system alerts for schedule modifications\n    await page.click('[data-testid=\"notification-event-schedule-modification\"]');\n    \n    const emailCheckbox = page.locator('[data-testid=\"notification-channel-email-schedule-modification\"]');\n    const systemAlertCheckbox = page.locator('[data-testid=\"notification-channel-system-alert-schedule-modification\"]');\n    \n    // Ensure email is enabled\n    if (!(await emailCheckbox.isChecked())) {\n      await emailCheckbox.check();\n    }\n    \n    // Disable system alerts\n    if (await systemAlertCheckbox.isChecked()) {\n      await systemAlertCheckbox.uncheck();\n    }\n    \n    // Step 4: Click 'Save' or 'Update Preferences' button\n    await page.click('[data-testid=\"save-notification-preferences-button\"]');\n    \n    // Expected Result: Preferences saved successfully\n    await expect(page.locator('[data-testid=\"preferences-success-message\"]')).toContainText('Preferences saved successfully');\n    \n    // Step 5: Navigate to an existing schedule and modify it\n    await page.goto('/schedules');\n    await expect(page.locator('[data-testid=\"schedules-list\"]')).toBeVisible();\n    \n    // Select first schedule\n    await page.click('[data-testid=\"schedule-item\"]', { position: { x: 10, y: 10 } });\n    await page.click('[data-testid=\"edit-schedule-button\"]');\n    \n    // Modify schedule details\n    await page.fill('[data-testid=\"schedule-time-start\"]', '10:00');\n    await page.fill('[data-testid=\"schedule-location-input\"]', 'Main Office - Building B');\n    await page.click('[data-testid=\"save-schedule-button\"]');\n    \n    // Expected Result: Schedule modification saved\n    await expect(page.locator('[data-testid=\"success-message\"]')).toContainText('Schedule updated successfully');\n    \n    // Step 6: Wait up to 1 minute and check notifications\n    await page.waitForTimeout(5000);\n    \n    // Navigate to notification logs\n    await page.goto('/admin/notification-logs');\n    await expect(page.locator('[data-testid=\"notification-logs-table\"]')).toBeVisible();\n    \n    // Expected Result: Notifications sent according to updated preferences\n    const modificationNotification = page.locator('[data-testid=\"notification-log-row\"]').first();\n    await expect(modificationNotification.locator('[data-testid=\"notification-type\"]')).toContainText('Schedule Modification');\n    await expect(modificationNotification.locator('[data-testid=\"notification-channels\"]')).toContainText('Email');\n    \n    // Expected Result: Disabled notification channels did not send notifications\n    await expect(modificationNotification.locator('[data-testid=\"notification-channels\"]')).not.toContainText('System Alert');\n    \n    // Expected Result: Delivery matches user preferences\n    await expect(modificationNotification.locator('[data-testid=\"notification-status\"]')).toContainText('Delivered');\n    \n    // Verify system alerts panel does NOT contain this modification\n    await page.goto('/notifications');\n    const systemAlerts = page.locator('[data-testid=\"system-alert-item\"]');\n    const alertCount = await systemAlerts.count();\n    \n    // Check that no recent system alert contains the modification\n    for (let i = 0; i < Math.min(alertCount, 5); i++) {\n      const alertText = await systemAlerts.nth(i).textContent();\n      expect(alertText).not.toContain('Schedule modified');\n      expect(alertText).not.toContain('Building B');\n    }\n  });\n});"
    }
  ]
}