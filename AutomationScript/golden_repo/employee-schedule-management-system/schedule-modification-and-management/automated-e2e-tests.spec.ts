json
{
  "success": true,
  "playwrightTests": [
    {
      "storyId": "story-8",
      "storyTitle": "As Scheduling Manager, I want to cancel shifts to handle unforeseen changes",
      "testFile": "cancel-shifts.spec.ts",
      "testCode": "import { test, expect } from '@playwright/test';\n\ntest.describe('Cancel Shifts - Scheduling Manager', () => {\n  test.beforeEach(async ({ page }) => {\n    // Navigate to schedule management page\n    await page.goto('/schedule-management');\n    // Wait for page to load\n    await page.waitForLoadState('networkidle');\n  });\n\n  test('Cancel scheduled shift successfully', async ({ page }) => {\n    // Step 1: Select a scheduled shift for cancellation\n    const shift = page.locator('[data-testid=\"shift-item\"]').first();\n    await shift.click();\n    \n    // Expected Result: Shift details displayed\n    await expect(page.locator('[data-testid=\"shift-details-panel\"]')).toBeVisible();\n    await expect(page.locator('[data-testid=\"shift-details-panel\"]')).toContainText(/Shift Details|Employee|Time/);\n    \n    // Store shift information for verification\n    const shiftId = await shift.getAttribute('data-shift-id');\n    const employeeName = await page.locator('[data-testid=\"shift-employee-name\"]').textContent();\n    \n    // Click the 'Cancel Shift' button\n    await page.locator('[data-testid=\"cancel-shift-button\"]').click();\n    \n    // Confirmation dialog should appear\n    await expect(page.locator('[data-testid=\"cancel-confirmation-dialog\"]')).toBeVisible();\n    await expect(page.locator('[data-testid=\"cancel-confirmation-dialog\"]')).toContainText(/Cancel Shift|Are you sure/);\n    \n    // Step 2: Confirm cancellation\n    await page.locator('[data-testid=\"confirm-cancel-button\"]').click();\n    \n    // Expected Result: Shift removed from schedule and confirmation displayed\n    await expect(page.locator('[data-testid=\"success-message\"]')).toBeVisible();\n    await expect(page.locator('[data-testid=\"success-message\"]')).toContainText(/Shift cancelled successfully|Cancellation confirmed/);\n    \n    // Verify the shift no longer appears in the schedule view\n    await page.waitForTimeout(1000); // Wait for UI update\n    const cancelledShift = page.locator(`[data-shift-id=\"${shiftId}\"]`);\n    await expect(cancelledShift).toHaveCount(0);\n    \n    // Step 3: Verify affected employees receive notifications\n    // Navigate to notification log\n    await page.locator('[data-testid=\"notifications-link\"]').click();\n    await page.waitForLoadState('networkidle');\n    \n    // Expected Result: Notifications delivered successfully\n    const notificationLog = page.locator('[data-testid=\"notification-log\"]');\n    await expect(notificationLog).toBeVisible();\n    \n    // Verify notification for the affected employee\n    const notification = page.locator('[data-testid=\"notification-item\"]').filter({ hasText: employeeName || '' });\n    await expect(notification).toBeVisible();\n    await expect(notification).toContainText(/Shift cancelled|Cancellation/);\n    \n    // Verify notification delivery status\n    const deliveryStatus = notification.locator('[data-testid=\"delivery-status\"]');\n    await expect(deliveryStatus).toContainText(/Delivered|Sent|Success/);\n  });\n\n  test('Prevent cancellation without confirmation', async ({ page }) => {\n    // Step 1: Select shift for cancellation\n    const shift = page.locator('[data-testid=\"shift-item\"]').first();\n    await shift.click();\n    \n    // Expected Result: Shift details displayed\n    await expect(page.locator('[data-testid=\"shift-details-panel\"]')).toBeVisible();\n    \n    // Store shift information for verification\n    const shiftId = await shift.getAttribute('data-shift-id');\n    const shiftText = await shift.textContent();\n    \n    // Click the 'Cancel Shift' button\n    await page.locator('[data-testid=\"cancel-shift-button\"]').click();\n    \n    // Expected Result: Confirmation dialog displayed\n    await expect(page.locator('[data-testid=\"cancel-confirmation-dialog\"]')).toBeVisible();\n    await expect(page.locator('[data-testid=\"cancel-confirmation-dialog\"]')).toContainText(/Cancel Shift|Are you sure/);\n    \n    // Step 2: Dismiss confirmation dialog\n    // Try to find dismiss button (could be 'Cancel', 'Dismiss', or 'X')\n    const dismissButton = page.locator('[data-testid=\"dismiss-cancel-button\"], [data-testid=\"cancel-button\"], [data-testid=\"close-dialog-button\"]').first();\n    await dismissButton.click();\n    \n    // Expected Result: Cancellation aborted and shift remains scheduled\n    // Confirmation dialog should be closed\n    await expect(page.locator('[data-testid=\"cancel-confirmation-dialog\"]')).not.toBeVisible();\n    \n    // Verify the shift still appears in the schedule\n    await page.waitForTimeout(500); // Brief wait to ensure UI stability\n    const existingShift = page.locator(`[data-shift-id=\"${shiftId}\"]`);\n    await expect(existingShift).toBeVisible();\n    await expect(existingShift).toContainText(shiftText || '');\n    \n    // Check that no notifications were sent to employees\n    // Navigate to notification log\n    await page.locator('[data-testid=\"notifications-link\"]').click();\n    await page.waitForLoadState('networkidle');\n    \n    // Get the latest notification timestamp before the cancellation attempt\n    const notificationItems = page.locator('[data-testid=\"notification-item\"]');\n    const notificationCount = await notificationItems.count();\n    \n    // Verify no new cancellation notifications were created\n    if (notificationCount > 0) {\n      const latestNotification = notificationItems.first();\n      const notificationText = await latestNotification.textContent();\n      // Ensure the latest notification is not about this shift cancellation\n      expect(notificationText).not.toContain('Shift cancelled');\n    }\n    \n    // Navigate back to schedule to verify shift integrity\n    await page.goto('/schedule-management');\n    await page.waitForLoadState('networkidle');\n    \n    // Final verification that shift is still present\n    const verifyShift = page.locator(`[data-shift-id=\"${shiftId}\"]`);\n    await expect(verifyShift).toBeVisible();\n  });\n});"
    }
  ]
}