json
{
  "success": true,
  "playwrightTests": [
    {
      "storyId": "story-7",
      "storyTitle": "As Scheduling Manager, I want to process shift swap requests to accommodate employee needs",
      "testFile": "shift-swap-requests.spec.ts",
      "testCode": "import { test, expect } from '@playwright/test';\n\ntest.describe('Shift Swap Request Processing', () => {\n  test.beforeEach(async ({ page }) => {\n    // Navigate to the application and login as manager\n    await page.goto('/login');\n    await page.fill('[data-testid=\"username-input\"]', 'scheduling.manager@company.com');\n    await page.fill('[data-testid=\"password-input\"]', 'Manager123!');\n    await page.click('[data-testid=\"login-button\"]');\n    await expect(page).toHaveURL(/.*dashboard/);\n  });\n\n  test('Approve valid shift swap request', async ({ page }) => {\n    // Step 1: Employee submits shift swap request\n    // Simulate employee submission by navigating to employee portal\n    await page.goto('/employee-portal');\n    await page.click('[data-testid=\"shift-swap-button\"]');\n    await page.selectOption('[data-testid=\"swap-with-employee-select\"]', 'Employee B');\n    await page.selectOption('[data-testid=\"my-shift-select\"]', 'Monday 9AM-5PM');\n    await page.selectOption('[data-testid=\"their-shift-select\"]', 'Tuesday 9AM-5PM');\n    await page.fill('[data-testid=\"swap-reason-textarea\"]', 'Personal appointment on Monday');\n    await page.click('[data-testid=\"submit-swap-request-button\"]');\n    \n    // Expected Result: Request recorded in system\n    await expect(page.locator('[data-testid=\"success-message\"]')).toContainText('Shift swap request submitted successfully');\n    const requestId = await page.locator('[data-testid=\"request-id\"]').textContent();\n    expect(requestId).toBeTruthy();\n\n    // Step 2: Manager reviews and approves request\n    // Switch to manager view\n    await page.goto('/manager/shift-swaps');\n    await page.waitForSelector('[data-testid=\"shift-swap-queue\"]');\n    \n    // Locate the submitted request\n    await page.click(`[data-testid=\"swap-request-${requestId}\"]`);\n    await expect(page.locator('[data-testid=\"request-details-modal\"]')).toBeVisible();\n    \n    // Validate swap feasibility details are displayed\n    await expect(page.locator('[data-testid=\"employee-a-name\"]')).toContainText('Employee A');\n    await expect(page.locator('[data-testid=\"employee-b-name\"]')).toContainText('Employee B');\n    await expect(page.locator('[data-testid=\"shift-compatibility-status\"]')).toContainText('Compatible');\n    await expect(page.locator('[data-testid=\"availability-status\"]')).toContainText('Available');\n    \n    // Approve the request\n    await page.click('[data-testid=\"approve-swap-button\"]');\n    \n    // Expected Result: Request status updated to approved\n    await expect(page.locator('[data-testid=\"request-status\"]')).toContainText('Approved');\n    await expect(page.locator('[data-testid=\"approval-confirmation\"]')).toContainText('Shift swap approved successfully');\n\n    // Step 3: System updates schedules and notifies employees\n    // Verify schedules are updated\n    await page.goto('/manager/schedules');\n    await page.fill('[data-testid=\"search-employee-input\"]', 'Employee A');\n    await page.click('[data-testid=\"search-button\"]');\n    await expect(page.locator('[data-testid=\"employee-a-tuesday-shift\"]')).toContainText('Tuesday 9AM-5PM');\n    \n    await page.fill('[data-testid=\"search-employee-input\"]', 'Employee B');\n    await page.click('[data-testid=\"search-button\"]');\n    await expect(page.locator('[data-testid=\"employee-b-monday-shift\"]')).toContainText('Monday 9AM-5PM');\n    \n    // Expected Result: Schedules updated and notifications sent\n    await page.goto('/manager/notifications');\n    await expect(page.locator('[data-testid=\"notification-list\"]')).toContainText('Shift swap approved');\n    await expect(page.locator('[data-testid=\"notification-employee-a\"]')).toContainText('Employee A');\n    await expect(page.locator('[data-testid=\"notification-employee-b\"]')).toContainText('Employee B');\n  });\n\n  test('Reject invalid shift swap request', async ({ page }) => {\n    // Step 1: Employee submits swap request with incompatible shifts\n    await page.goto('/employee-portal');\n    await page.click('[data-testid=\"shift-swap-button\"]');\n    await page.selectOption('[data-testid=\"swap-with-employee-select\"]', 'Employee C');\n    \n    // Select incompatible shifts (different roles/qualifications)\n    await page.selectOption('[data-testid=\"my-shift-select\"]', 'Monday 9AM-5PM - Nurse');\n    await page.selectOption('[data-testid=\"their-shift-select\"]', 'Tuesday 9AM-5PM - Doctor');\n    await page.fill('[data-testid=\"swap-reason-textarea\"]', 'Need to swap shifts');\n    await page.click('[data-testid=\"submit-swap-request-button\"]');\n    \n    // Expected Result: Request recorded\n    await expect(page.locator('[data-testid=\"success-message\"]')).toContainText('Shift swap request submitted');\n    const requestId = await page.locator('[data-testid=\"request-id\"]').textContent();\n    expect(requestId).toBeTruthy();\n\n    // Step 2: Manager attempts to approve request\n    await page.goto('/manager/shift-swaps');\n    await page.waitForSelector('[data-testid=\"shift-swap-queue\"]');\n    \n    // Navigate to the invalid swap request\n    await page.click(`[data-testid=\"swap-request-${requestId}\"]`);\n    await expect(page.locator('[data-testid=\"request-details-modal\"]')).toBeVisible();\n    \n    // Review incompatibility warnings\n    await expect(page.locator('[data-testid=\"validation-warning\"]')).toBeVisible();\n    await expect(page.locator('[data-testid=\"incompatibility-reason\"]')).toContainText('Role mismatch');\n    \n    // Attempt to approve\n    await page.click('[data-testid=\"approve-swap-button\"]');\n    \n    // Expected Result: System blocks approval with validation error\n    await expect(page.locator('[data-testid=\"validation-error-modal\"]')).toBeVisible();\n    await expect(page.locator('[data-testid=\"error-message\"]')).toContainText('Cannot approve: Shifts have incompatible requirements');\n    await expect(page.locator('[data-testid=\"error-details\"]')).toContainText('Role qualifications do not match');\n    \n    // Close error modal\n    await page.click('[data-testid=\"close-error-modal-button\"]');\n\n    // Step 3: Manager rejects request\n    await page.click('[data-testid=\"reject-swap-button\"]');\n    await page.fill('[data-testid=\"rejection-reason-textarea\"]', 'Incompatible shift requirements - different role qualifications');\n    await page.click('[data-testid=\"confirm-reject-button\"]');\n    \n    // Expected Result: Request status updated to rejected and notification sent\n    await expect(page.locator('[data-testid=\"request-status\"]')).toContainText('Rejected');\n    await expect(page.locator('[data-testid=\"rejection-confirmation\"]')).toContainText('Shift swap rejected');\n    \n    // Verify notification sent\n    await page.goto('/manager/notifications');\n    await expect(page.locator('[data-testid=\"notification-list\"]')).toContainText('Shift swap rejected');\n    await expect(page.locator('[data-testid=\"rejection-notification\"]')).toContainText('Incompatible shift requirements');\n    \n    // Verify original schedules remain unchanged\n    await page.goto('/manager/schedules');\n    await page.fill('[data-testid=\"search-employee-input\"]', 'Employee A');\n    await page.click('[data-testid=\"search-button\"]');\n    await expect(page.locator('[data-testid=\"employee-a-monday-shift\"]')).toContainText('Monday 9AM-5PM - Nurse');\n    \n    await page.fill('[data-testid=\"search-employee-input\"]', 'Employee C');\n    await page.click('[data-testid=\"search-button\"]');\n    await expect(page.locator('[data-testid=\"employee-c-tuesday-shift\"]')).toContainText('Tuesday 9AM-5PM - Doctor');\n  });\n});"
    }
  ]
}